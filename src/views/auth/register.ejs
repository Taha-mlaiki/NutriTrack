<%- include('../partials/header') %>
<!-- Header -->

 <%- include('../partials/navbar') %>

<!-- Auth Container -->
<div class="flex min-h-screen pt-20 md:pt-0">
  <!-- Left side image -->
  <div
    class="hidden md:flex flex-1 bg-cover bg-center items-center justify-center text-white p-8"
    style="
      background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),
        url('https://images.unsplash.com/photo-1490818387583-1baba5e638af?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
    "
  >
    <div class="max-w-md text-center">
      <h2 class="text-3xl md:text-4xl font-bold mb-4">
        Rejoignez la communaut√© NutriTrack
      </h2>
      <p>
        Commencez votre parcours vers une meilleure sant√© avec un suivi
        nutritionnel personnalis√©.
      </p>
      <ul class="mt-6 space-y-3 text-left">
        <li class="flex items-center">
          <i class="fas fa-check-circle text-primary-green mr-2"></i> Analysez
          vos repas avec l'IA
        </li>
        <li class="flex items-center">
          <i class="fas fa-check-circle text-primary-green mr-2"></i>
          Recommandations personnalis√©es
        </li>
        <li class="flex items-center">
          <i class="fas fa-check-circle text-primary-green mr-2"></i> Rapports
          d√©taill√©s
        </li>
      </ul>
    </div>
  </div>

  <!-- Right side form -->
  <div class="flex-1 flex flex-col justify-center max-w-md w-full mx-auto p-8">
    <h2 class="text-2xl font-bold text-center mb-6">Cr√©er un compte</h2>
    <p class="text-center text-gray mb-6">
      Rejoignez NutriTrack pour commencer votre parcours sant√©
    </p>

    <form class="space-y-6">
      <!-- Full name -->
      <div>
        <label for="fullName" class="block mb-1 font-medium text-dark"
          >Nom complet</label
        >
        <input
          id="fullName"
          type="text"
          placeholder="Entrez votre nom complet"
          class="w-full px-4 py-3 border border-light-gray rounded-lg focus:ring-2 focus:ring-primary-green focus:outline-none"
        />
      </div>

      <!-- Email -->
      <div>
        <label for="email" class="block mb-1 font-medium text-dark"
          >Adresse email</label
        >
        <input
          id="email"
          type="email"
          placeholder="Entrez votre email"
          class="w-full px-4 py-3 border border-light-gray rounded-lg focus:ring-2 focus:ring-primary-green focus:outline-none"
        />
      </div>

      <!-- Password -->
      <div class="relative">
        <label for="password" class="block mb-1 font-medium text-dark"
          >Mot de passe</label
        >
        <input
          id="password"
          type="password"
          placeholder="Cr√©ez un mot de passe"
          class="w-full px-4 py-3 border border-light-gray rounded-lg focus:ring-2 focus:ring-primary-green focus:outline-none"
        />
        <i
          class="fas fa-eye absolute right-4 top-1/2 translate-y-1/2 text-gray cursor-pointer"
        ></i>
      </div>

      <!-- Confirm password -->
      <div class="relative">
        <label for="confirmPassword" class="block mb-1 font-medium text-dark"
          >Confirmer le mot de passe</label
        >
        <input
          id="confirmPassword"
          type="password"
          placeholder="Confirmez votre mot de passe"
          class="w-full px-4 py-3 border border-light-gray rounded-lg focus:ring-2 focus:ring-primary-green focus:outline-none"
        />
        <i
          class="fas fa-eye absolute right-4 top-1/2 translate-y-1/2 text-gray cursor-pointer"
        ></i>
      </div>

      <!-- Profile selection -->
      <div>
        <label class="block mb-1 font-medium text-dark"
          >Profil de sant√© principal</label
        >
        <div class="grid grid-cols-2 gap-2 mt-2">
          <label
            class="peer-checked:border-primary-green peer-checked:bg-green-50 border-2 border-light-gray rounded-lg text-center py-2 cursor-pointer hover:border-primary-green"
          >
            <input
              type="radio"
              name="profile"
              value="diabetes"
              class="hidden peer"
            />
            diabetes
          </label>

          <label
            class="peer-checked:border-primary-green peer-checked:bg-green-50 border-2 border-light-gray rounded-lg text-center py-2 cursor-pointer hover:border-primary-green"
          >
            <input
              type="radio"
              name="profile"
              value="hypertension"
              class="hidden peer"
            />
            Hypertension
          </label>
          <label
            class="peer-checked:border-primary-green peer-checked:bg-green-50 border-2 border-light-gray rounded-lg text-center py-2 cursor-pointer hover:border-primary-green"
          >
            <input
              type="radio"
              name="profile"
              value="obesity"
              class="hidden peer"
            />
            Obesity
          </label>
          <label
            class="peer-checked:border-primary-green peer-checked:bg-green-50 border-2 border-light-gray rounded-lg text-center py-2 cursor-pointer hover:border-primary-green"
          >
            <input
              type="radio"
              name="profile"
              value="athlete"
              class="hidden peer"
            />
            Athlete
          </label>
          <label
            class="peer-checked:border-primary-green peer-checked:bg-green-50 border-2 border-light-gray rounded-lg text-center py-2 cursor-pointer hover:border-primary-green"
          >
            <input
              type="radio"
              name="profile"
              value="weight_loss"
              class="hidden peer"
            />
            Weight loss
          </label>
          <label
            class="peer-checked:border-primary-green peer-checked:bg-green-50 border-2 border-light-gray rounded-lg text-center py-2 cursor-pointer hover:border-primary-green"
          >
            <input
              type="radio"
              name="profile"
              value="muscle_gain"
              class="hidden peer"
            />
            Muscle gain
          </label>
        </div>
      </div>

      <!-- Submit -->
      <button
        type="submit"
        class="w-full bg-primary-orange text-white py-3 rounded-full font-semibold hover:bg-[#F57C00] transition-transform hover:-translate-y-0.5 shadow-md hover:shadow-lg"
      >
        Cr√©er un compte
      </button>
    </form>

    <div class="text-center mt-6 text-gray">
      Vous avez d√©j√† un compte?
      <a href="login" class="text-primary-green font-medium hover:underline"
        >Connectez-vous</a
      >
    </div>
  </div>
</div>
<%- include('../partials/toast') %>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.querySelector("form");
    const fullName = document.getElementById("fullName");
    const email = document.getElementById("email");
    const password = document.getElementById("password");
    const confirmPassword = document.getElementById("confirmPassword");
    const toggleIcons = document.querySelectorAll(".fa-eye");

    const profileLabels = document.querySelectorAll(
      "label input[name='profile']"
    );

    profileLabels.forEach((input) => {
      input.addEventListener("change", () => {
        // remove active style from all
        profileLabels.forEach((el) => {
          el.parentElement.classList.remove(
            "border-primary-green",
            "bg-green-50"
          );
        });
        // add active style to selected
        if (input.checked) {
          input.parentElement.classList.add(
            "border-primary-green",
            "bg-green-50"
          );
        }
      });
    });

    // üîê Toggle password visibility
    toggleIcons.forEach((icon) => {
      icon.addEventListener("click", () => {
        const input = icon.previousElementSibling;
        input.type = input.type === "password" ? "text" : "password";
        icon.classList.toggle("fa-eye-slash");
      });
    });

    // üìã Form validation
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      let errors = [];

      if (fullName.value.trim().length < 3) {
        errors.push("Le nom complet doit contenir au moins 3 caract√®res.");
      }

      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)) {
        errors.push("Veuillez entrer une adresse email valide.");
      }

      if (password.value.length < 6) {
        errors.push("Le mot de passe doit contenir au moins 6 caract√®res.");
      }

      if (password.value !== confirmPassword.value) {
        errors.push("Les mots de passe ne correspondent pas.");
      }

      const profile = form.querySelector("input[name='profile']:checked");
      if (!profile) {
        errors.push("Veuillez s√©lectionner un profil de sant√©.");
      }

      if (errors.length > 0) {
        alert(errors.join("\n"));
        return;
      }

      // ‚úÖ Simulate sending data to server
      const formData = {
        fullName: fullName.value,
        email: email.value,
        password: password.value,
        profile: profile.value,
      };

      console.log("Form submitted:", formData);
      // Example: send to backend with fetch
      try {
        const res = await axios.post("/auth/register", formData);

        if (res.data.success) {
          showToast("Inscription r√©ussie", "success");
          setTimeout(() => {
            window.location.href = "/auth/login";
          }, 1500);
        }
      } catch (err) {
        showToast(err.response.data.message, "error");
      }
    });
  });
</script>
<%- include('../partials/footer') %>
