<%- include('../partials/header') %>

<!-- Auth Container -->
<div class="flex min-h-screen pt-20 md:pt-0">
  <!-- Left side image -->
  <div
    class="hidden md:flex flex-1 bg-cover bg-center items-center justify-center text-white p-8"
    style="
      background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),
        url('https://images.unsplash.com/photo-1490818387583-1baba5e638af?auto=format&fit=crop&w=1350&q=80');
    "
  >
    <div class="max-w-md text-center">
      <h2 class="text-3xl md:text-4xl font-bold mb-4">
        Rejoignez la communaut√© NutriTrack
      </h2>
      <p>
        Commencez votre parcours vers une meilleure sant√© avec un suivi
        nutritionnel personnalis√©.
      </p>
    </div>
  </div>

  <!-- Right side form -->
  <div class="flex-1 flex flex-col justify-center max-w-md w-full mx-auto p-8">
    <h2 class="text-2xl font-bold text-center mb-2">Connexion</h2>
    <p class="text-center text-gray mb-6">
      Connectez-vous √† votre compte NutriTrack
    </p>

    <form id="loginForm" class="space-y-6">
      <!-- Email -->
      <div>
        <label for="email" class="block mb-1 font-medium text-dark"
          >Adresse email</label
        >
        <input
          id="email"
          type="email"
          placeholder="Entrez votre email"
          class="w-full px-4 py-3 border border-light-gray rounded-lg focus:ring-2 focus:ring-primary-green focus:outline-none"
        />
        <p id="emailError" class="text-red-500 text-sm mt-1 hidden"></p>
      </div>

      <!-- Password -->
      <div class="relative">
        <label for="password" class="block mb-1 font-medium text-dark"
          >Mot de passe</label
        >
        <input
          id="password"
          type="password"
          placeholder="Votre mot de passe"
          class="w-full px-4 py-3 border border-light-gray rounded-lg focus:ring-2 focus:ring-primary-green focus:outline-none"
        />
        <i
          class="fas fa-eye absolute right-4 top-1/2 translate-y-1/2 text-gray cursor-pointer"
          id="togglePassword"
        ></i>
        <p id="passwordError" class="text-red-500 text-sm mt-1 hidden"></p>
      </div>

      <!-- Submit -->
      <button
        type="submit"
        class="w-full bg-primary-orange text-white py-3 rounded-full font-semibold hover:bg-[#F57C00] transition-transform hover:-translate-y-0.5 shadow-md hover:shadow-lg"
      >
        Se connecter
      </button>
    </form>

    <div class="text-center mt-6 text-gray">
      Vous n'avez pas un compte ?
      <a href="register" class="text-primary-green font-medium hover:underline"
        >Inscrivez-vous</a
      >
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("loginForm");
    const email = document.getElementById("email");
    const password = document.getElementById("password");
    const emailError = document.getElementById("emailError");
    const passwordError = document.getElementById("passwordError");
    const togglePassword = document.getElementById("togglePassword");

    // üëÅ Toggle password visibility
    togglePassword.addEventListener("click", () => {
      password.type = password.type === "password" ? "text" : "password";
      togglePassword.classList.toggle("fa-eye-slash");
    });

    // üìù Form validation
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      let valid = true;

      // Reset errors
      emailError.classList.add("hidden");
      passwordError.classList.add("hidden");

      // Validate email
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)) {
        emailError.textContent = "Veuillez entrer une adresse email valide.";
        emailError.classList.remove("hidden");
        valid = false;
      }

      // Validate password
      if (password.value.trim().length < 6) {
        passwordError.textContent =
          "Le mot de passe doit contenir au moins 6 caract√®res.";
        passwordError.classList.remove("hidden");
        valid = false;
      }

      if (!valid) return;

      // ‚úÖ Send to backend
      try {
        const res = await axios.post("/auth/login", {
          email: email.value,
          password: password.value,
        });

        if (res.data.success) {
          showToast("Login Successfull", "success");
          setTimeout(() => {
            window.location.href = "/dashboard";
          }, 1500);
        }
      } catch (err) {
        console.error(err);
        passwordError.textContent =
          err.response.data.message || "Erreur de connexion. R√©essayez.";
        passwordError.classList.remove("hidden");
      }
    });
  });
</script>

<%- include('../partials/footer') %>
